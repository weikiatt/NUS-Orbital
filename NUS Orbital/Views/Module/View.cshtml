@model NUS_Orbital.Models.ModulePost


<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="~/NUS_Orbital.styles.css" asp-append-version="true" />
    <link rel="stylesheet" type="text/css" href="~/css/style.css">

    <script defer src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
</head>


<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-lg-3 col-md-4 text-center">
                <h1 class="text-green text-uppercase">@Model.module.moduleCode</h1>
                <p class="text-secondary">@Model.module.moduleName</p>
            </div>
            <div class="col text-justify">
                <p>@Model.module.description</p>
            </div>
        </div>
    </div>

    <div class="container pt-3">
        <h5>Reviews and Discussions</h5>
        <div class="row">
            <div class="col-fixed width-50"> 
                <img class="profile-picture wh-50" src="~/images/StudentPhotos/@Model.student.photo" />
            </div>
            <form class="col" method="post" action="~/Module/Post">
                <input hidden value="@Model.module.moduleCode" name="moduleCode" />
                <h6>Let others how you feel about this module!</h6>
                <textarea class="w-100 form-control" placeholder="join the discussion..." id="postInput" oninput="showPostButton()" name="description"/></textarea>
                <div class="justify-content-end align-items-end d-flex">
                    <button type="reset" class="btn-cancel btn-pill hidden" id="cancelButton" onclick="hidePostButton()">Cancel</button>
                    <button type="submit" class="btn-green btn-pill mt-2 hidden" id="postButton">Post</button>
                </div>
            </form>





        </div>
        <div class="mt-3">
            @foreach (var post in Model.posts)
            {
                <div class="row">
                    <div class="col-fixed width-50">
                        <img class="profile-picture wh-50" src="~/images/StudentPhotos/@post.student.photo" />
                    </div>
                    <div class="col">
                        <div class="d-flex">
                            <h5 class="text-green text-uppercase">@post.student.name </h5>
                            <p class="text-secondary ms-5">  - @post.student.course Student</p>
                        </div>
                        <p class="text-secondary">@post.postTime</p>
                        <p>@post.description</p>
                        <div class="d-flex">
                            <p class="bg-danger">@post.upvotes upvotes, @post.downvotes downvotes</p>
                            <button onclick="showCommentBox(@post.postId)" class="btn-comment">Reply to post</button>
                        </div>
                    </div>
                </div>
                <div class="row mt-3 comment-box hidden" id="commentBox @post.postId">
                    <div class="col-fixed width-50"></div>
                    <div class="col">
                        <div class="row">
                            <div class="col-fixed width-50">
                                <img class="profile-picture wh-50" src="~/images/StudentPhotos/@Model.student.photo" />
                            </div>
                            <form class="col" method="post" action="~/Module/Comment">
                                <input hidden value="@Model.module.moduleCode" name="moduleCode" />
                                <input hidden value="@post.postId" name="postId" />
                                <h6>Comment...</h6>
                                <textarea class="w-100 form-control" placeholder="join the discussion..." name="description"></textarea>
                                <div class="justify-content-end align-items-end d-flex">
                                    <button type="reset" class="btn-cancel btn-pill" onclick="hideCommentBox(@post.postId)">Cancel</button>
                                    <button type="submit" class="btn-green btn-pill mt-2 ">Comment</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                @if (post.comments.Count() > 0)
                {
                    <div class="row">
                        <button class="btn-view-reply btn-pill text-dark-green" style="margin-left:50px;">View Replies</button>
                        <div class="container hidden mt-3">
                            <div class="row">
                                <div class="col-fixed width-50"></div>
                                <div class="col">
                                    @foreach (var comment in post.comments)
                                    {
                                        <div class="row">
                                            <div class="col-fixed width-50">
                                                <img class="profile-picture wh-50" src="~/images/StudentPhotos/@comment.student.photo" />
                                            </div>
                                            <div class="col">
                                                <div class="d-flex">
                                                    <h5 class="text-green text-uppercase">@comment.student.name</h5>
                                                    <p class="text-secondary"> - @comment.student.course Student</p>
                                                </div>
                                                <p class="text-secondary">@comment.commentTime</p>
                                                <p>@comment.description</p>
                                                <p>@comment.upvotes upvotes, @comment.downvotes downvotes</p>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
                
                
            }
        </div>
    </div>
    <script>
        document.querySelectorAll('.btn-view-reply').forEach(button => {
            button.addEventListener('click', function () {
                const nextRow = this.nextElementSibling;
                nextRow.classList.toggle('hidden');
                if (nextRow.classList.contains('hidden')) {
                    this.textContent = 'View Replies';
                } else {
                    this.textContent = 'Hide Replies';
                }
            });
        });

        function showPostButton() {
            var postInput = document.getElementById("postInput");
            var postButton = document.getElementById("postButton");
            var cancelButton = document.getElementById("cancelButton");
            if (postButton.classList.contains('hidden')) {
                postButton.classList.toggle('hidden');
                cancelButton.classList.toggle('hidden');
            }
        }
        document.getElementById("postInput").addEventListener("input", toggleCommentButton);

        function hidePostButton() {
            var postButton = document.getElementById("postButton");
            var cancelButton = document.getElementById("cancelButton");
            postButton.classList.toggle('hidden');
            cancelButton.classList.toggle('hidden');
        }

        function showCommentBox(postId) {
            var commentBox = document.getElementById("commentBox " + postId);
            if (commentBox.classList.contains('hidden')) {
                commentBox.classList.toggle('hidden');
            }
        }

        function hideCommentBox(postId) {
            var commentBox = document.getElementById("commentBox " + postId);
            if (!commentBox.classList.contains('hidden')) {
                commentBox.classList.toggle('hidden');
            }
        }
    </script>
</body>
</html>